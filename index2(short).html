<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>간단 약 추천</title>
</head>
<body>
    <div>
        <form>
            <input type="text">
            <button type="submit">전송</button>
        </form>
        <div id="contents"></div>
    </div>
    <script>
        let $input = document.querySelector('input')
        let $button = document.querySelector('button')
        
        let data = [{
            "role": "system",
            "content": "assistant는 pharmacist입니다."
        }, {
            "role": "user",
            "content": "약국에서 파는 감기약 알려줘"
        }, {
            "role": "assistant",
            "content": "판콜에스내복액30ml\n 성인 1회 1병(30ml)을 식후 30분에 복용합니다\n 유효성분에는 아세트아미노펜, 구아이페네신, 클로르페니라민말레산염, 카페인무수물, DL-메틸에페드린염산염 등이 포함되어 있습니다. 판피린큐액20ml\n 성인 1회 20ml를 1일 3회 식후 30분에 복용합니다\n 유효성분에는 티페피딘시트르산염, 클로르페니라민말레산염, 구아이페네신, 카페인무수물, dl-메틸에페드린염산염, 아세트아미노펜 등이 포함되어 있습니다."
        }, {
            "role": "user",
            "content": "약국에서 파는 고혈압약 알려줘"
        }, {
            "role": "assistant",
            "content": "광동우황청심원현탁액50ml(천연사향)\n 성인 1회 1병 복용합니다\n 유효성분에는 산약, 시호, 우황, 작약 등이 포함되어 있습니다."
        }, {
            "role": "user",
            "content": "약국에서 파는 구토약 알려줘"
        }, {
            "role": "assistant",
            "content": "베나치오에프액75ml\n 성인 1회 1병 복용합니다\n 유효성분에는 육계, 회향, 현호색, 창출, 진피, 건강, 감초 등이 포함되어 있습니다."
        }, {
            "role": "user",
            "content": "약국에서 파는 기침약 알려줘"
        }, {
            "role": "assistant",
            "content": "킥코프에프\n 성인 1일 3회, 1회 2캡슐 식후 30분에 복용합니다\n 유효성분에는 아세트아미노펜, 구아이페네신, DL-메틸에페드린염산염, 덱스트로메토르판브롬화수소산염수화물 등이 포함되어 있습니다. 인펙신\n 성인 1회 2캡슐을 1일 3회 식전 또는 식간에 복용합니다\n 유효성분에는 우방자, 박하, 감초, 영양각, 연교, 형개, 금은화, 두시, 담죽엽, 길경 등이 포함되어 있습니다. 래피콜코프\n 성인 1일 3회, 1회 2캡슐 식후 30분에 복용합니다\n 유효성분에는 구아이페네신, 클로르페니라민말레산염, DL-메틸에페드린염산염, 덱스트로메토르판브롬화수소산염수화물 등이 포함되어 있습니다."
        }, {
            "role": "user",
            "content": "약국에서 파는 두통약 알려줘"
        }, {
            "role": "assistant",
            "content": "게보린정\n 성인 1회 1정 1일 3회까지 공복(빈속)시를 피하여 복용하며, 복용간격은 4시간 이상으로 합니다. 이 약은 원칙적으로 단기 복용합니다\n 유효성분에는 이소프로필안티피린, 아세트아미노펜, 카페인무수물 등이 포함되어 있습니다. 타이레놀정\n (325mg 기준)성인 매 8시간마다 4정씩 복용하며 24시간 동안 12정을 초과하지 않습니다\n 유효성분에는 아세트아미노펜 등이 포함되어 있습니다."
        }, {
            "role": "user",
            "content": "약국에서 파는 물집약 알려줘"
        }, {
            "role": "assistant",
            "content": "마스터치크림\n 환부의 가장자리까지 충분히 적용할 수 있는 적당량으로 하여 1일 5회, 5일 동안 사용합니다\n 유효성분에는 아시클로버, 히드로코르티손 등이 포함되어 있습니다. 바시락크림\n 성인 4시간 간격으로 1일 5회 환부에 사용합니다. 치료는 5일간 계속하여야 하며, 5일간 사용 후에도 치료되지 않을 경우에는 5일간 더 사용할 수 있습니다\n 유효성분에는 아시클로버 등이 포함되어 있습니다. 바로서겔\n 감염된 부위에 1일 2~3회 적당량을 발라줍니다. 심한 삼출성 상처에는 드레싱이 권장되며 이 약을 1~2회 사용 시마다 드레싱을 교체하는 것을 권장합니다\n 유효성분에는 티로트리신 등이 포함되어 있습니다."
        }, {
            "role": "user",
            "content": "약국에서 파는 복통약 알려줘"
        }, {
            "role": "assistant",
            "content": "https://terms.naver.com/entry.naver?docId=6478684&cid=59913&categoryId=59913"
        },]

        let url = `https://estsoft-openai-api.jejucodingcamp.workers.dev/`;
        
        $button.addEventListener('click', e =>{
            e.preventDefault()
            userInputData = $input.value
            $input.value = ''

            data.push({
                "role": "user",
                "content": userInputData
            }) 
            // 답변 목록도 push를 하면 맥락을 이해하여 답변이 가능합니다.
            // DAY 1, DAY 2, DAY 3와 같은 형식으로 답변해줘라고 미리 학습을 시켜놓으면 split('DAY') 이런 식으로 Card를 만들 수 있습니다.

            chatGptAPI()
        })

        function chatGptAPI(){
            fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
                redirect: "follow",
            })
            .then(res => res.json())
            .then(res => {
                // console.log(res)
                // console.log(res.choices[0].message.content)
                document.querySelector('#contents').innerText = res.choices[0].message.content
            })
            // 아래 코드는 fetch 성공, 실패, 통신 중 여부와 상관없이 실행됩니다. 비동기에요.
            console.log('ChatGPT가 생각하고 있어요! 여유를 가지고 기다려주세요:)')
        }
    </script>
</body>
</html>